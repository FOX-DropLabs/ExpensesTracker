<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Registro de Gastos e Ingresos - Pesos Argentinos</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    /* [Estilos iguales al código anterior] */
  </style>
</head>
<body class="p-4">
  <!-- [HTML igual al código anterior] -->
  <script>
    const API_URL = "https://sheetdb.io/api/v1/5b0et060artk7"; // Verifica esta URL
    let entries = [];
    let expensesChart;
    let editingId = null;

    const defaultCategories = ['Comida', 'Transporte', 'Entretenimiento', 'Vivienda', 'Salud'];
    let categories = [];

    function setDefaultDate() {
      const today = new Date();
      const yyyy = today.getFullYear();
      const mm = String(today.getMonth() + 1).padStart(2, '0');
      const dd = String(today.getDate()).padStart(2, '0');
      document.getElementById('date').value = `${yyyy}-${mm}-${dd}`;
      const currentMonth = `${yyyy}-${mm}`;
      document.getElementById('monthFilter').value = currentMonth;
    }

    async function fetchEntries() {
      try {
        console.log('Intentando cargar desde:', API_URL);
        const res = await fetch(API_URL);
        console.log('Respuesta HTTP:', res.status, res.statusText);
        if (!res.ok) {
          throw new Error(`Error HTTP: ${res.status} - ${res.statusText}`);
        }
        const rawData = await res.json();
        console.log('Respuesta cruda:', rawData);
        // Check if it's wrapped in 'data'
        entries = Array.isArray(rawData) ? rawData : (rawData.data || []);
        console.log('Entradas procesadas:', entries);
        if (entries.length === 0) {
          console.warn('No hay entradas en la base de datos. Verifica que el Sheet tenga datos.');
        }
        fetchCategories();
        updateUI();
      } catch (error) {
        console.error('Error al cargar las entradas:', error);
        alert('Error al cargar las entradas. Revisa la consola para detalles.');
      }
    }

    // [Resto de funciones igual, con console.log agregados donde sea necesario]

    document.addEventListener('DOMContentLoaded', () => {
      setDefaultDate();
      fetchEntries();
    });
  </script>
</body>
</html>
